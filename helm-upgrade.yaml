parameters:
  projectName: ''
  chart: ''
  releaseName: ''
  resourceGroup: 'k8-Consortium'
  cluster: 'Consortium'

steps:
  - task: AzureCLI@1
  displayName: 'Helm Dependency Upgrade ${{ parameters.projectName }}'
  inputs:
    azureSubscription: 'Microsoft Azure Enterprise (181b1a02-9555-44fb-84c1-7d23c91ff8c6)'
    scriptLocation: inlineScript
    inlineScript: |
     helm init -c
     az acr helm repo add --name iusdev
     helm dep up ${{ parameters.chart }}

- task: HelmDeploy@0
  displayName: 'helm upgrade ${{ parameters.projectName }}'
  inputs:
    azureSubscription: 'Microsoft Azure Enterprise (181b1a02-9555-44fb-84c1-7d23c91ff8c6)'
    azureResourceGroup: '${{ parameters.resourceGroup }}'
    kubernetesCluster: ${{ parameters. cluster}}
    namespace: default
    command: upgrade
    chartType: FilePath
    chartPath: '${{ parameters.chart }}'
    releaseName: ${{ parameters.releaseName }}
    waitForExecution: false
